<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cost Analysis</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #333; background: #fff; }
    h2 { color: #2c3e50; margin-bottom: 12px; }

    .summary-section { display: flex; gap: 30px; margin-bottom: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px; }
    .summary-item { text-align: center; }
    .summary-value { font-size: 28px; font-weight: bold; color: #2c3e50; margin-bottom: 4px; }
    .summary-label { font-size: 13px; color: #666; }
    .summary-change { font-size: 13px; color: #28a745; font-weight: 500; }

    .chart-section { margin-bottom: 10px; }
    .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .chart-controls { display: flex; gap: 10px; }
    .chart-controls select { padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; background: white; }

    .chart-container { height: 300px; background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; }
    .chart-bars { display: flex; align-items: end; height: 200px; gap: 8px; margin-bottom: 12px; }
    .chart-bar { flex: 1; display: flex; flex-direction: column; align-items: center; }
    .bar-segment { width: 100%; margin-bottom: 2px; border-radius: 2px; }
    .bar-segment.aws { background-color: #FF9900; }
    .bar-segment.azure { background-color: #0078D4; }
    .bar-segment.gcp { background-color: #4285F4; }
    .bar-segment.vmware { background-color: #607078; }
    .bar-label { font-size: 12px; color: #666; margin-top: 6px; transform: rotate(-45deg); white-space: nowrap; }
    .chart-legend { display: flex; justify-content: center; gap: 16px; margin-top: 8px; }
    .legend-item { display: flex; align-items: center; gap: 8px; }
    .legend-color { width: 14px; height: 14px; border-radius: 2px; }
  </style>
</head>
<body>
  <h2>Cost Analysis</h2>

  <div class="summary-section">
    <div class="summary-item">
      <div class="summary-value" id="total-cost">$0.00</div>
      <div class="summary-label">Total Cost / Month</div>
    </div>
    <div class="summary-item">
      <div class="summary-value" id="trend" style="color:#28a745;">0%</div>
      <div class="summary-label">Spending compared to last month</div>
    </div>
    <div class="summary-item">
      <div class="summary-value" id="change" style="color:#28a745;">$0.00</div>
      <div class="summary-label">Savings</div>
    </div>
    <div class="summary-item">
      <div class="summary-label" id="range">-</div>
    </div>
  </div>

  <div class="chart-section">
    <div class="chart-header">
      <h3>Cost Analysis</h3>
      <div class="chart-controls">
        <select><option>Provider Name</option></select>
        <select><option>Stacked Bar Chart</option></select>
      </div>
    </div>
    <div class="chart-container">
      <div class="chart-bars" id="chart-bars"></div>
      <div class="chart-legend">
        <div class="legend-item"><div class="legend-color" style="background:#FF9900"></div><span>AWS</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#0078D4"></div><span>Azure</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#4285F4"></div><span>GCP</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#607078"></div><span>VMware</span></div>
      </div>
    </div>
  </div>

  <script>
    let data = {};
    function getData() {
      if (window.openai && window.openai.toolOutput) {
        const t = window.openai.toolOutput;
        return t.structuredContent ?? t; // support both shapes
      }
      if (window.__mcpContent) {
        return window.__mcpContent.structuredContent ?? window.__mcpContent;
      }
      return {
        summary: { total: 210045.45, trend: 12, change: 25205.45, dateRange: "May 28, 2024 - June 9, 2024" },
        series: [
          { date: "2024-05-28", aws: 8500, azure: 3200, gcp: 2800, vmware: 1200 },
          { date: "2024-05-29", aws: 9200, azure: 3500, gcp: 3100, vmware: 1300 },
          { date: "2024-05-30", aws: 8800, azure: 3300, gcp: 2900, vmware: 1250 }
        ]
      };
    }

    function updateSummaryValues() {
      const s = data.summary || {};
      const fmt = (n) => (typeof n === 'number' ? n : 0);
      document.getElementById('total-cost').textContent = `$${fmt(s.total).toLocaleString()}`;
      document.getElementById('trend').textContent = `${fmt(s.trend)}%`;
      document.getElementById('change').textContent = `$${fmt(s.change).toLocaleString()}`;
      document.getElementById('range').textContent = s.dateRange || '';
    }

    function generateChart() {
      const chartContainer = document.getElementById('chart-bars');
      chartContainer.innerHTML = '';
      const series = data.dailyData || data.series || [];
      if (series.length === 0) return;
      const maxValue = Math.max(...series.map(d => (d.aws||0) + (d.azure||0) + (d.gcp||0) + (d.vmware||0)));
      series.forEach(day => {
        const barContainer = document.createElement('div');
        barContainer.className = 'chart-bar';
        const segments = [
          { value: day.aws||0, class: 'aws', height: ((day.aws||0) / maxValue) * 180 },
          { value: day.azure||0, class: 'azure', height: ((day.azure||0) / maxValue) * 180 },
          { value: day.gcp||0, class: 'gcp', height: ((day.gcp||0) / maxValue) * 180 },
          { value: day.vmware||0, class: 'vmware', height: ((day.vmware||0) / maxValue) * 180 }
        ];
        segments.forEach(segment => {
          if (segment.value > 0) {
            const segmentDiv = document.createElement('div');
            segmentDiv.className = `bar-segment ${segment.class}`;
            segmentDiv.style.height = `${segment.height}px`;
            barContainer.appendChild(segmentDiv);
          }
        });
        const label = document.createElement('div');
        label.className = 'bar-label';
        label.textContent = new Date(day.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        barContainer.appendChild(label);
        chartContainer.appendChild(barContainer);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      data = getData();
      updateSummaryValues();
      generateChart();
    });
  </script>
</body>
</html>

